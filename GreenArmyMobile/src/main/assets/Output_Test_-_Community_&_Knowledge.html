

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
        input[type=checkbox] {
            -webkit-transform: scale(1.5); margin:50px;
        }
    </style>
    
    <script src="fieldcapture/static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="fieldcapture/static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="fieldcapture/static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="fieldcapture/static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="fieldcapture/static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="fieldcapture/static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="fieldcapture/static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="fieldcapture/static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/fieldcapture/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/fieldcapture/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="fieldcapture/static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="fieldcapture/static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="fieldcapture/static/2OXdKoom668LE7PLl0qjJCaLG7Pu7Jv869tAsS4e1oT.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="fieldcapture/static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        serverUrl: "http://devt.ala.org.au:8087/fieldcapture",
        activityUpdateUrl: "/fieldcapture/activity/ajaxUpdate",
        activityDeleteUrl: "/fieldcapture/activity/ajaxDelete",
        projectViewUrl: "/fieldcapture/project/index/",
        siteViewUrl: "/fieldcapture/site/index/",
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "/fieldcapture/proxy/speciesProfile"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    

</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">

            <div class="row-fluid space-after">
                <div class="span4 required">
                    <label for="startDate"><b>Actual start date</b>
                        <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>


                    <div class="input-append">
                        <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
                <div class="span8 required">
                    <label for="endDate"><b>Actual end date</b>
                        <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                    </label>

                    <div class="input-append">
                        <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                    </div>

                </div>
            </div>
            <div class="row-fluid space-after">
                <div class="span6">
                    <label for="theme"><b>Major theme</b></label>
                    <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge">
                    </select>
                </div>

            </div>
            <div class="row-fluid">
                <div class="span4">
                    <label for="site"><b>Site</b></label>
                    <select id='site' width='100%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                    <br/>Leave blank if this activity is not associated with a specific site.

                </div>

                <div class="span8">
                    <img width="250" height="200" data-bind="attr:{src:transients.siteImgUrl}"/>
                </div>


            </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
    
    
    <div class="output-block" id="koParticipant_Information">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Participant Information<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section">
<div class="row-fluid space-after " >
<span class="span2">    <span  class="preLabel required"><label>Total No. of Participants (not employed on project):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of participants involved in an activity who are not employed in the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalParticipantsNotEmployed' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span2">    <span  class="preLabel required"><label>No of Indigenous Participants (not employed on project):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of indigenous people participating in an activity who are not employed in the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfIndigenousParticipants' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span2">    <span  class="preLabel required"><label>Total No. of participants not previously attending events for this project (ie. new participants in the project):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of participants involved in an activity who have not attended other activities associated with the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalParticipantsNew' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span2">    <span  class="preLabel required"><label>Total No. of indigenous on-country visits:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of unique indigenous on-country visits undertaken as part of this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOnCountryVisits' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span2">    <span  class="preLabel required"><label>No of community groups participating:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of different community groups participating in this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfCommunityGroups' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span2">    <span  class="preLabel required"><label>No of farming entities not previously attending events for this project:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of farm entities represented by participants in an activity, which have not previously been represented at other project activities'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfFarmingEntitiesNew' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div>
</div><div class="row-fluid space-after " >
<span class="span12">    </span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koEvent_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Event Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>Purpose of event:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The purpose for which the event is being conducted'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.eventPurposeConstraints">
                <li>
                    <label data-bind="attr:{for: 'eventPurpose'+$index()}"><input type="checkbox" name="data.eventPurpose" data-bind="value:$data,checked:$root.data.eventPurpose,attr:{id: 'eventPurpose'+$index()}"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"/></label></span>
                </li>
            </ul>
        </span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Main industry type addressed:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The main industry type that the event is addressing'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.industryType,options:transients.industryTypeConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Topics covered:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The theme or topic covered during the event. Add in notes if more than one'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.eventTopics'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Event Duration (Hrs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The duration of the event in hours. Part hour expressed as a decimal'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.eventDurationHrs' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:</label></span><textarea  class="span12" data-bind='value:data.eventNotes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koMaterials_Provided_to_Participants">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Materials Provided to Participants<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of Written Materials and brochures:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of items of written materials (incl. brochures) taken by participants at an event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfWrittenMaterials' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of Material Recipients:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual participants taking materials at an event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfMaterialRecipients' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of Displays at the event:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of individual displays and presentations given at an event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfDisplays' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>

        
    </div>

    
    
    
    <div class="output-block" id="koIndigenous_Employment">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Indigenous Employment<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>No. of indigenous rangers employed on the project</h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Full time:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of indigenous rangers employed full time on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousRangersFt' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Part time:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of indigenous rangers employed part time on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousRangersPt' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Males:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of male indigenous rangers employed on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousRangersMale' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Females:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of female indigenous rangers employed on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousRangersFemale' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total No. of project employees who are indigenous rangers:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total No. of project employees who are indigenous rangers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalRangerEmployees'></span></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span8"><h4>No. of indigenous people employed on the project who are not rangers</h4></span></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Full time:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of indigenous people employed full time on the project who are not rangers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousNonRangersFt' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Part time:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of indigenous people employed part time on the project who are not rangers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousNonRangersPt' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Males:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of indigenous males employed on the project who are not rangers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousNonRangersMale' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Females:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of indigenous females employed on the project who are not rangers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.noOfIndigenousNonRangersFemale' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total No. of project employees who are not rangers:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total No. of project employees who are not rangers'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalNonRangerEmployees'></span></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span2">    <span  class="preLabel"><label>Total full time employees:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total number of indigenous people employed full time on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalFtEmployees'></span></span><span class="span2">    <span  class="preLabel"><label>Total part time employees:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total number of indigenous people employed part time on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalPtEmployees'></span></span><span class="span2">    <span  class="preLabel"><label>Total male employees:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total number of indigenous males employed on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalMaleEmployees'></span></span><span class="span2">    <span  class="preLabel"><label>Total female employees:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total number of indigenous females employed on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalFemaleEmployees'></span></span><span class="span2">    <span  class="preLabel"><label>Total No. of project employees:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Total number of indigenous people employed on the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><span  data-bind='text:data.totalEmployees'></span></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koIndigenous_Enterprise">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Indigenous Enterprise<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section">
<div class="row-fluid space-after " >
<span class="span3">    <span  class="preLabel"><label>type(s) of enterprises established by indigenous communities:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the type(s) of enterprises established by indigenous communities as a result of this project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.typeOfEnterprise'></textarea></span><span class="span3">    <span  class="preLabel required"><label>No. of new enterprises established:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of new enterprises established as a result of this project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalNewEnterprises' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="preLabel"><label>No. of indigenous communities in which new enterprises have been established:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of indigenous communities in which new enterprises have been established as a result of this project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfIndigenousCommunities' data-validation-engine='validate[min[0],custom[number]]' type='number' class='input-mini'/></span><span class="span3">    <span  class="preLabel required"><label>No of contracts that have been established by Indigenous enterprises:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of contracts established by an Indigenous enterprise resulting from this project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalIndigenousEnterprisesEngaged' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div>
</div><div class="row-fluid space-after " >
<span class="span12">    </span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koKnowledge_Integration_and_Transfer">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Knowledge Integration and Transfer<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>No. of indigenous on-country visits with older and younger people together:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of unique indigenous on-country visits undertaken as part of this activity that were attended by older and younger people together'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOnCountryVisits' data-validation-engine='validate[required,min[0],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Were indigenous decision-makers involved in organising or running this activity?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Involvement of indigenous decision-making bodies in the project'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.indigenousDecisionMakers,options:transients.indigenousDecisionMakersConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Has any indigenous knowledge been documented as part of this activity?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Has any indigenous knowledge been documented as part of this activity?'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.indigenousKnowledgeDocumented,options:transients.indigenousKnowledgeDocumentedConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of datasets shared publicly as a result of this activity:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of datasets collected and shared publicly'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.datasetsShared' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of formal partnerships established:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Number of formal partnerships (eg. MOUs, joint delivery, etc.) involved in design, delivery and/or monitoring to guide implementation'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.formalPartnerships' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Notes / Comments:</label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    <style type="text/css">
        table.courseAttendance td:nth-child(1) {width:35%;}
        table.courseAttendance td:nth-child(1) select {width:100%;}
        table.courseAttendance td:nth-child(2) {width:25%;}
        table.courseAttendance td:nth-child(2) select {width:100%;}
        table.courseAttendance td:nth-child(3) {width:25%;}
        table.courseAttendance td:nth-child(3) select {width:100%;}
        table.courseAttendance td:nth-child(4) {width:15%;text-align:center;}
        table.courseAttendance td:nth-child(4) select {width:100%;}
        table.courseAttendance td:last-child {width:4%;text-align:center;}
        table.courseAttendance textarea {width:98%;}
    </style>
    <div class="output-block" id="koTraining_Details">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Training Details<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after " >
<span class="span12">    <span  class="span12">Please enter details of formal training courses attended by project participants.</span></span></div>
<div class="row-fluid output-section">
            <table class="table table-bordered courseAttendance " >
                <thead><tr><th class="required">Type of course attended:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Type of course'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">Course title:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Title of the course attended'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th>Course qualification level:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The density of grazing stock used to achieve the purpose of the activity expressed in Dry Sheep Equivalents per hectare'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th class="required">No. of people who completed the course:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of people who completed the course and received the qualification'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></th><th></th>
                </tr></thead>
                <tbody data-bind="template:{name:'courseAttendanceviewTmpl', foreach: data.courseAttendance}"></tbody>
                <script id="courseAttendanceviewTmpl" type="text/html"><tr>
                    <td><select data-bind='value:typeOfCourse,options:transients.typeOfCourseConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></td>
                    <td><input  class="input-medium" data-bind='value:courseTitle'  data-validation-engine='validate[required]' type='text' class='input-small'/></td>
                    <td><select data-bind='value:qualificationLevel,options:transients.qualificationLevelConstraints,optionsCaption:"Please select"'></select></td>
                    <td><input class="input-small" style="text-align:center" data-bind='value:numberCompleted' data-validation-engine='validate[required,custom[number],min[0]]' type='number' class='input-mini'/></td>
                    <td><i data-bind='click:$root.removecourseAttendanceRow' class='icon-remove'></i></td>
                </tr></script>
                <tfoot>
                <tr>
                    <td colspan='2'><span ></span></td>
                    <td><span >Total No. of attendees completing courses:</span></td>
                    <td><span  class="value" data-bind='text:data.totalCompletingCourses'></span></td>
                    <td></td>
                </tr>
                <tr><td colspan="5" style="text-align:left;">
                        <button type="button" class="btn btn-small" data-bind="click:addcourseAttendanceRow">
                        <i class="icon-plus"></i> Add a row</button>
                        <button type="button" class="btn btn-small" data-bind="click:showcourseAttendanceTableDataUpload"><i class="icon-upload"></i> Upload data for this table</button>


                    </td></tr>
<tr data-bind="visible:courseAttendanceTableDataUploadVisible"><td colspan="5">
                <div class="text-error text-left">
                    Note: Only valid exact scientific names will be matched and populated from the database (indicated by a green tick). Unmatched species will load, but will be indicated by a green <b>?</b>. Please check your uploaded data and correct as required.
                </div>
                <div class="text-left" style="margin:5px">
                    <a href="/fieldcapture/proxy/excelOutputTemplate?type=Training Details&listName=courseAttendance" target="courseAttendanceTemplateDownload" class="btn">Step 1 - Download template (.xlsx)</a>
                </div>
                <div class="text-left" style="margin:5px;">
                    <input type="checkbox" data-bind="checked:appendTableRows" style="margin-right:5px">Append uploaded data to table (unticking this checkbox will result in all table rows being replaced)
                </div>

                <div class="btn fileinput-button" style="margin-left:5px">
                        <input id="courseAttendanceTableDataUpload" type="file" name="data" data-bind="fileUploadNoImage:courseAttendanceTableDataUploadOptions">
                        Step 2 - Upload populated template
                </div>

                    </td></tr> <script id="courseAttendancetemplate-upload" type="text/x-tmpl">{% %}</script>
                       <script id="courseAttendancetemplate-download" type="text/x-tmpl">{% %}</script>                </tfoot>
            </table>
        </div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Comments / Notes:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General notes about this activity'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

        
    </div>

    
    
    
    <div class="output-block" id="koSkills_Development">
        <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Skills Development<i class="icon-asterisk modified-icon" data-bind="visible:dirtyFlag.isDirty" title="Has been modified" style="display: none;"></i></h3>
        <!-- add the dynamic components -->
        <div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span4 checkbox-list-label  preLabel required"><label>How have the skills and learning outcomes of participants in this project been applied?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Areas where skills that participants have learnt during this project have been practically applied either within or external to the project.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span>
            <ul class="checkbox-list" data-bind="foreach: transients.skillsApplicationConstraints">
                <li>
                    <label data-bind="attr:{for: 'skillsApplication'+$index()}"><input type="checkbox" name="data.skillsApplication" data-bind="value:$data,checked:$root.data.skillsApplication,attr:{id: 'skillsApplication'+$index()}"  data-validation-engine='validate[minCheckbox[1]]'/><span data-bind="text:$data"/></label></span>
                </li>
            </ul>
        </span></div></div></div>
<div class="row-fluid space-after output-section" >
<div class="span12">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Notes / Comments:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about this activity, additional skills not listed, etc.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span8" data-bind='value:data.notes'></textarea></span></div></div></div>

        
    </div>

<!-- /ko -->

</div>




</div>

<script src="fieldcapture/static/DzazZ2ePykd4QRUJlInoAO1LMvzeVxjM2JRcis2usBm.js" type="text/javascript" ></script>



<script src="fieldcapture/static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="fieldcapture/static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="fieldcapture/static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="fieldcapture/static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="fieldcapture/static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="fieldcapture/static/NbeGWZssK95I6Y1Oz4lzxzRtDzf9dyFLZiTstPEonQa.js" type="text/javascript" ></script>
<script src="fieldcapture/static/L85LaBY6yhQwMk24PuXWgqwvtkfvbmMZ3ExPR9xK96.js" type="text/javascript" ></script>
<script src="fieldcapture/static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="fieldcapture/static/w51VyweI3KQvr6P2DTUzBcR9OpWeX0ktL7UktpeA1k.js" type="text/javascript" ></script>





<script src="fieldcapture/static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="fieldcapture/static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="fieldcapture/static/yzVPTi9KJTOMgo1ytEFVw7JiBXXkkbj5dU3cYZoIuS.js" type="text/javascript" ></script>

<script src="fieldcapture/static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
        $(function(){

            var viewModelName = "Participant_InformationViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Participant Information";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.totalParticipantsNotEmployed = ko.observable();

            self.data.numberOfIndigenousParticipants = ko.observable();

            self.data.numberOnCountryVisits = ko.observable();

            self.data.totalParticipantsNew = ko.observable();

            self.data.numberOfCommunityGroups = ko.observable();

            self.data.numberOfFarmingEntitiesNew = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['totalParticipantsNotEmployed'](orZero(data['totalParticipantsNotEmployed']));
                self.data['numberOfIndigenousParticipants'](orZero(data['numberOfIndigenousParticipants']));
                self.data['numberOnCountryVisits'](orZero(data['numberOnCountryVisits']));
                self.data['totalParticipantsNew'](orZero(data['totalParticipantsNew']));
                self.data['numberOfCommunityGroups'](orZero(data['numberOfCommunityGroups']));
                self.data['numberOfFarmingEntitiesNew'](orZero(data['numberOfFarmingEntitiesNew']));


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Participant Information') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koParticipant_Information"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Event_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Event Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                                self.data.eventPurpose=ko.observableArray([]);
            self.transients.eventPurposeConstraints = ["Awareness raising event (eg. demonstration, field day, or study tour)","Training session, workshop or other skills/training event","Knowledge evaluation event","Works implementation","Planning","Other (describe in notes)"];
                
        self.loadeventPurpose = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.eventPurpose.push(obj);
                });
        }};
        
            self.data.eventTopics = ko.observable();

            self.data.eventDurationHrs = ko.observable();

            self.data.industryType = ko.observable();
            self.transients.industryTypeConstraints = ["Sugarcane","Grazing","Grains","Grapes","Vegetables","Fruit trees","Berries","Dairy","Cotton","Forestry","Aquaculture","Fishing","Other (specify in notes)"];

            self.data.eventNotes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadeventPurpose(data['eventPurpose']);
                self.data['eventTopics'](data['eventTopics']);
                self.data['eventDurationHrs'](orZero(data['eventDurationHrs']));
                self.data['industryType'](data['industryType']);
                self.data['eventNotes'](data['eventNotes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Event Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koEvent_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Materials_Provided_to_ParticipantsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Materials Provided to Participants";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.numberOfWrittenMaterials = ko.observable();

            self.data.numberOfMaterialRecipients = ko.observable();

            self.data.numberOfDisplays = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['numberOfWrittenMaterials'](orZero(data['numberOfWrittenMaterials']));
                self.data['numberOfMaterialRecipients'](orZero(data['numberOfMaterialRecipients']));
                self.data['numberOfDisplays'](orZero(data['numberOfDisplays']));


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Materials Provided to Participants') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koMaterials_Provided_to_Participants"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Indigenous_EmploymentViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Indigenous Employment";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.noOfIndigenousRangersFt = ko.observable();

            self.data.noOfIndigenousRangersPt = ko.observable();

            self.data.noOfIndigenousRangersMale = ko.observable();

            self.data.noOfIndigenousRangersFemale = ko.observable();

            self.data.noOfIndigenousNonRangersFt = ko.observable();

            self.data.noOfIndigenousNonRangersPt = ko.observable();

            self.data.noOfIndigenousNonRangersMale = ko.observable();

            self.data.noOfIndigenousNonRangersFemale = ko.observable();

            self.data.totalFtEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.noOfIndigenousRangersFt());
total += Number(self.data.noOfIndigenousNonRangersFt());
                return total;            });

            self.data.totalPtEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.noOfIndigenousRangersPt());
total += Number(self.data.noOfIndigenousNonRangersPt());
                return total;            });

            self.data.totalMaleEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.noOfIndigenousRangersMale());
total += Number(self.data.noOfIndigenousNonRangersMale());
                return total;            });

            self.data.totalFemaleEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.noOfIndigenousRangersFemale());
total += Number(self.data.noOfIndigenousNonRangersFemale());
                return total;            });

            self.data.totalEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.totalFtEmployees());
total += Number(self.data.totalPtEmployees());
                return total;            });

            self.data.totalNonRangerEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.noOfIndigenousNonRangersFt());
total += Number(self.data.noOfIndigenousNonRangersPt());
                return total;            });

            self.data.totalRangerEmployees = ko.computed(function () {
var total = 0;total += Number(self.data.noOfIndigenousRangersFt());
total += Number(self.data.noOfIndigenousRangersPt());
                return total;            });
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['noOfIndigenousRangersFt'](orZero(data['noOfIndigenousRangersFt']));
                self.data['noOfIndigenousRangersPt'](orZero(data['noOfIndigenousRangersPt']));
                self.data['noOfIndigenousRangersMale'](orZero(data['noOfIndigenousRangersMale']));
                self.data['noOfIndigenousRangersFemale'](orZero(data['noOfIndigenousRangersFemale']));
                self.data['noOfIndigenousNonRangersFt'](orZero(data['noOfIndigenousNonRangersFt']));
                self.data['noOfIndigenousNonRangersPt'](orZero(data['noOfIndigenousNonRangersPt']));
                self.data['noOfIndigenousNonRangersMale'](orZero(data['noOfIndigenousNonRangersMale']));
                self.data['noOfIndigenousNonRangersFemale'](orZero(data['noOfIndigenousNonRangersFemale']));


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Indigenous Employment') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koIndigenous_Employment"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Indigenous_EnterpriseViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Indigenous Enterprise";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.typeOfEnterprise = ko.observable();

            self.data.totalNewEnterprises = ko.observable();

            self.data.numberOfIndigenousCommunities = ko.observable();

            self.data.totalIndigenousEnterprisesEngaged = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['typeOfEnterprise'](data['typeOfEnterprise']);
                self.data['totalNewEnterprises'](orZero(data['totalNewEnterprises']));
                self.data['numberOfIndigenousCommunities'](orZero(data['numberOfIndigenousCommunities']));
                self.data['totalIndigenousEnterprisesEngaged'](orZero(data['totalIndigenousEnterprisesEngaged']));


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Indigenous Enterprise') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koIndigenous_Enterprise"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Knowledge_Integration_and_TransferViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Knowledge Integration and Transfer";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.indigenousKnowledgeDocumented = ko.observable();
            self.transients.indigenousKnowledgeDocumentedConstraints = ["Yes","No"];

            self.data.indigenousDecisionMakers = ko.observable();
            self.transients.indigenousDecisionMakersConstraints = ["Yes","No"];

            self.data.numberOnCountryVisits = ko.observable();

            self.data.datasetsShared = ko.observable();

            self.data.formalPartnerships = ko.observable();

            self.data.treatmentCostPerHa = ko.observable();

            self.data.pestDensityPerHa = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.data['indigenousKnowledgeDocumented'](data['indigenousKnowledgeDocumented']);
                self.data['indigenousDecisionMakers'](data['indigenousDecisionMakers']);
                self.data['numberOnCountryVisits'](orZero(data['numberOnCountryVisits']));
                self.data['datasetsShared'](orZero(data['datasetsShared']));
                self.data['formalPartnerships'](orZero(data['formalPartnerships']));
                self.data['treatmentCostPerHa'](orZero(data['treatmentCostPerHa']));
                self.data['pestDensityPerHa'](orZero(data['pestDensityPerHa']));
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Knowledge Integration and Transfer') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koKnowledge_Integration_and_Transfer"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Training_DetailsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var CourseAttendanceRow = function (data) {
            var self = this;
            if (!data) data = {};
            self.transients = {};
            this.totalCompletingCourses = ko.observable(orBlank(data['totalCompletingCourses']));
            this.typeOfCourse = ko.observable(orBlank(data['typeOfCourse']));
            self.transients.typeOfCourseConstraints = ["Vocational - Occupational Health & Safety","Vocational - First aid","Other vocational skills - short course (specify)","Science degree or higher","Other (specify in notes)"];
            this.courseTitle = ko.observable(orBlank(data['courseTitle']));
            this.qualificationLevel = ko.observable(orBlank(data['qualificationLevel']));
            self.transients.qualificationLevelConstraints = ["Senior Secondary Certificate of Education","AQF Level 1  Certificate I","AQF Level 2  Certificate II","AQF Level 3  Certificate III","AQF Level 4  Certificate IV","AQF Level 5  Diploma","AQF Level 6  Advanced Diploma, Associate Degree","AQF Level 7  Bachelor Degree","AQF Level 8  Bachelor Honours Degree","Graduate Certificate, Graduate Diploma","AQF Level 9  Masters Degree","AQF Level 10  Doctoral Degree","Other (specify in notes)"];
            this.numberCompleted = ko.observable(orZero(data['numberCompleted']));
        };
        var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Training Details";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.courseAttendance = ko.observableArray([]);
            self.selectedcourseAttendanceRow = ko.observable();
        

            self.loadcourseAttendance = function (data, append) {
                if (!append) {
                    self.data.courseAttendance([]);
                }
                if (data === undefined) {
                    self.addcourseAttendanceRow();
                } else {
                    $.each(data, function (i, obj) {
                        self.data.courseAttendance.push(new CourseAttendanceRow(obj));
                    });
                }
            };

            self.addcourseAttendanceRow = function () {
                var newRow = new CourseAttendanceRow();
                self.data.courseAttendance.push(newRow);
                
            };
            self.removecourseAttendanceRow = function (row) {
                self.data.courseAttendance.remove(row);
                
            };
            self.courseAttendancerowCount = function () {
                return self.data.courseAttendance().length;
            };

            self.courseAttendanceTableDataUploadVisible = ko.observable(false);
            self.showcourseAttendanceTableDataUpload = function() {
                self.courseAttendanceTableDataUploadVisible(!self.courseAttendanceTableDataUploadVisible());
            };

            self.courseAttendanceTableDataUploadOptions = {
                    url:'/fieldcapture/activity/ajaxUpload',
                    done:function(e, data) {
                        if (data.result.error) {
                            self.uploadFailed(data.result.error);
                        }
                        else {
                            self.loadcourseAttendance(data.result.data, self.appendTableRows());
                        }
                    },
                    fail:function(e, data) {
                        var message = 'Please contact MERIT support and attach your spreadsheet to help us resolve the problem';
                        self.uploadFailed(data);

                    },
                    uploadTemplateId: "courseAttendancetemplate-upload",
                    downloadTemplateId: "courseAttendancetemplate-download",
                    formData:{type:'Training Details', listName:'courseAttendance'}
            };
            self.appendTableRows = ko.observable(true);
            self.uploadFailed = function(message) {
                        var text = "<span class='label label-important'>Important</span><h4>There was an error uploading your data.</h4>";
                        text += "<p>"+message+"</p>";
                        bootbox.alert(text)
            };

            self.data.totalCompletingCourses = ko.computed(function () {
                var total = 0;
                for(var i = 0; i < self.data.courseAttendance().length; i++) {
                    var value = self.data.courseAttendance()[i].numberCompleted();
                        total = total + Number(value); 
                }
                return total;
            });

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                                    delete jsData.selectedcourseAttendanceRow;
                delete jsData.courseAttendanceTableDataUploadOptions
                delete jsData.courseAttendanceTableDataUploadVisible

                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadcourseAttendance(data.courseAttendance);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Training Details') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koTraining_Details"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        
        $(function(){

            var viewModelName = "Skills_DevelopmentViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                    var speciesLists = [];
        var site = {};


            this[viewModelName] = function (output) {
                var self = this;
                self.name = "Skills Development";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                                self.data.skillsApplication=ko.observableArray([]);
            self.transients.skillsApplicationConstraints = ["Higher duties","Managing teams","More responsibility","New employment opportunities","Able to do tasks requiring licenses","Other (specify in notes)"];
                
        self.loadskillsApplication = function (data) {
            if (data !== undefined) {
                $.each(data, function (i, obj) {
                    self.data.skillsApplication.push(obj);
                });
        }};
        
            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                    
                    delete jsData.activityType;
                    delete jsData.transients;
                    return jsData;
                };

                // this returns a JS object ready for saving
                self.modelForSaving = function () {
                    // get model as a plain javascript object
                    var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                    // get rid of any transient observables
                    return self.removeBeforeSave(jsData);
                };

                // this is a version of toJSON that just returns the model as it will be saved
                // it is used for detecting when the model is modified (in a way that should invoke a save)
                // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
                self.modelAsJSON = function () {
                    return JSON.stringify(self.modelForSaving());
                };

                self.loadData = function (data) {
                    // load dynamic data
                                    self.loadskillsApplication(data['skillsApplication']);
                self.data['notes'](data['notes']);


                    // if there is no data in tables then add an empty row for the user to add data
                    if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                        self.addRow();
                    }
                    self.transients.dummy.notifySubscribers();
                };
            };


            var savedData = activity;
            if (!savedData.outputs) {
                savedData.outputs = [];
            }
            var savedOutput = {};
            if (savedData) {

                $.each(savedData.outputs, function(i, tmpOutput) {
                    if (tmpOutput.name === 'Skills Development') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koSkills_Development"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

        


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         */
        this.save = function () {

            var activityData, outputs = [];
            if ($('#validation-container').validationEngine('validate')) {
                $.each(this.subscribers, function(i, obj) {
                   // if (obj.isDirty()) {
                        if (obj.model === 'activityModel') {
                            activityData = obj.get();
                        } else {
                            outputs.push(obj.get());
                        }
                    //}
                });
                if (outputs.length === 0 && activityData === undefined) {
                    alert("Nothing to save.");
                    return;
                }
                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                console.log("saving"+toSave);
                mobileBindings.saveActivity(toSave);

            }

        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        

        saveActivity:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var themes = ['theme1', 'theme2'];

var sites = JSON.parse(mobileBindings.loadSites());


$(function(){

    $('#validation-container').validationEngine('attach', {scroll: false});

    $('.helphover').popover({animation: true, trigger:'hover'});

    $('#reset').click(function () {
        master.reset();
    });


    ko.bindingHandlers.editOutput = {
        init: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
            var outputName = ko.utils.unwrapObservable(valueAccessor()),
                activity = bindingContext.$root,
                outputId;

            // search for corresponding outputs in the activity data
            $.each(activity.outputs, function (i,output) { // iterate output data in the activity to
                                                              // find any matching the meta-model name
                if (output.name === outputName) {
                    outputId = output.outputId;
                }
            });
            if (outputId) {
                // build edit link
                $(element).html('Edit data');
                $(element).attr('href', fcConfig.serverUrl + "/output/edit/" + outputId +
                    "?returnTo=" + here);
            } else {
                // build create link
                $(element).attr('href', fcConfig.serverUrl + '/output/create?activityId=' + activity.activityId +
                    '&outputName=' + encodeURIComponent(outputName) +
                    "&returnTo=" + here);
            }
        }
    };

    function ViewModel (act, sites) {
        var self = this;
        self.activityId = act.activityId;
        self.description = ko.observable(act.description);
        self.notes = ko.observable(act.notes);
        self.startDate = ko.observable(act.startDate).extend({simpleDate: false});
        self.endDate = ko.observable(act.endDate || act.plannedEndDate).extend({simpleDate: false});
        self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
        self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
        self.eventPurpose = ko.observable(act.eventPurpose);
        self.fieldNotes = ko.observable(act.fieldNotes);
        self.associatedProgram = ko.observable(act.associatedProgram);
        self.associatedSubProgram = ko.observable(act.associatedSubProgram);
        self.progress = ko.observable(act.progress);
        self.mainTheme = ko.observable(act.mainTheme);
        self.type = ko.observable(act.type);
        self.siteId = ko.observable(act.siteId);
        self.projectId = act.projectId;
        self.transients = {};
        self.transients.sites = sites;
        self.transients.activityProgressValues = ['planned','started','finished'];
        self.transients.themes = themes;
        self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
        self.transients.markedAsFinished.subscribe(function (finished) {
            self.progress(finished ? 'finished' : 'started');
        });
        self.transients.siteImgUrl = ko.computed(function() {
            if (self.siteId()) {
                 var site = $.grep(self.transients.sites, function(site, index) { return site.siteId == self.siteId(); })[0];
                 if (site && site.extent && site.extent.geometry && site.extent.geometry.centre) {
                    return  "http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=250x200&markers=color:red%7C"+site.extent.geometry.centre[1]+","+site.extent.geometry.centre[0]+"&centre=false";
                 }
            }
            return "";
        });

        self.modelForSaving = function () {
            // get model as a plain javascript object
            var jsData = ko.toJS(self);
            delete jsData.transients;
            return jsData;
        };
        self.modelAsJSON = function () {
            return JSON.stringify(self.modelForSaving());
        };

        self.save = function (callback, key) {
        };

        self.notImplemented = function () {
            alert("Not implemented yet.")
        };
        self.dirtyFlag = ko.dirtyFlag(self, false);

        // make sure progress moves to started if we save any data (unless already finished)
        // (do this here so the model becomes dirty)
        self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
    }


    var viewModel = new ViewModel(activity, sites);

    ko.applyBindings(viewModel);

    master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);
});
</script>
</body>
</html>