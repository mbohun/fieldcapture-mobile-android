

<!DOCTYPE html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <script src="static/UGoJGyG3j2UCffTg3vnOdi0FsnS2OvrmrsZD6WxaXGy.js" type="text/javascript" ></script>
<link href="static/Eu8FNKwJJQI8mVJO3VIshatRN1bunflYHvvdqk06tbf.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/090onaZX1M508oSWqGmMeETZ9NkUA9p4CCTW3MUpRPc.css" type="text/css" rel="stylesheet" media="screen, projection" />

<link href="static/CidRUyEAqkZsnDRPRiaGZBy7vd4DOlnRqweu4CsVcIG.css" type="text/css" rel="stylesheet" media="screen" />
<link href="static/tDKPE9VWZfBnSnxBkPC52ml2dXticvlQDl9aR8VpM2o.css" type="text/css" rel="stylesheet" media="screen, projection" />
<!--[if lt IE 7]><link href="static/v1vjA9BeNpSU8cuoTuVhTEUm6boSzwYQcgfPKKMkqgv.css" type="text/css" rel="stylesheet" media="screen, projection" /><![endif]-->

<link href="http://www.ala.org.au/wp-content/themes/ala2011/images/favicon.ico" rel="shortcut icon" />
<!--[if lt IE 9]><script src="static/Yh1Txee3hFzExJ4P1str7tGV24zQMEYtxqtlYJ5ukR0.js" type="text/javascript" ></script><![endif]-->
<link href="static/6tuLClj7N5eYCZpx7vLn8juIbQUXBkCnWRUJFY7UDCz.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="/static/7ARiB2rJgSkfi68hxnSlcG9Ot0gQ863DYxkCmSHQweE.png" rel="shortcut icon" />
<link href="/static/14SWTr4VqVh6tnlUlgBtue6IJZ7gwE1y42RT7ya5GGW.png" rel="shortcut icon" />

<link href="static/KYGDEVRRaKjNbTXJkHmicmzo9vFrnnzCnGLcxKjR04f.css" type="text/css" rel="stylesheet" media="screen,print" />

<link href="static/uUQBvO5ITMKwLfoRb2u62GbHXEzxtsbrSWq8MBAOrbX.css" type="text/css" rel="stylesheet" media="screen,print" />
<link href="static/Rvy1AbvbH6TVlcTqc4lz71v5o0HJyz9D7Q8u2LCGGX2.css" type="text/css" rel="stylesheet" media="screen, projection" />
<link href="static/AcXIjLTuc87n8sfxBjJRQSoBIUwP9RnCyK8Sv82i7eV.css" type="text/css" rel="stylesheet" media="screen, projection" />
<script type="text/javascript">
    var fcConfig = {
        bieUrl: "http://bie.ala.org.au",
        speciesProfileUrl: "https://fieldcapture-test.ala.org.au/proxy/speciesProfile",
        googleStaticUrl:"http://maps.googleapis.com/maps/api/staticmap?maptype=terrian&zoom=12&sensor=false&size=350x250&markers=color:red%7C"
        },
        here = document.location.href;
    </script>
    

    <meta name="layout" content="mobile"/>

    
    

    <style type="text/css">
        input[type=checkbox] {  -webkit-transform: scale(1.5); }
        .checkbox-list label { min-height: 40px; }
        .speciesAutocompleteRow {min-height:40px;}
        .datepicker td, .datepicker th {
            width:40px;
            height:40px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

<div id="content" class="clearfix">
    
<div class="container-fluid validationEngineContainer" id="validation-container">
<div id="koActivityMainBlock">

    <div class="row-fluid">
        <div class="span12">
            <!-- Common activity fields -->

            <div class="row-fluid space-after">
                <div class="span4">

                    <label class="for-readonly">Type</label>
                    <span class="readonly-text" data-bind="text:type"></span>
                </div>
                <div class="span8">

                    <label class="for-readonly">Description</label>
                    <span class="readonly-text" data-bind="text:description"></span>
                </div>
            </div>


            <div class="row-fluid space-after">
                <div class="span4">
                    <label class="for-readonly inline">Planned start date</label>
                    <span class="readonly-text" data-bind="text:plannedStartDate.formattedDate"></span>
                </div>
                <div class="span8">
                    <label class="for-readonly inline">Planned end date</label>
                    <span class="readonly-text" data-bind="text:plannedEndDate.formattedDate"></span>
                </div>
            </div>

            <div class="well">
                <div class="row-fluid">

                    <span class="span8">
                        <div class="row-fluid space-after">

                            <div class="span6 required">
                                <label for="startDate"><b>Actual start date</b>
                                    <a href='#' class='helphover' data-original-title='Start date' data-placement='top' data-content='Date the activity was started.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                                </label>


                                <div class="input-append">
                                    <input data-bind='datepicker:startDate.date' name='startDate' id='startDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='startDate.date' data-validation-engine='validate[required]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                                </div>

                            </div>
                            <div class="span6" data-bind="css:{required:transients.markedAsFinished}">
                                <label for="endDate"><b>Actual end date</b>
                                    <a href='#' class='helphover' data-original-title='End date' data-placement='top' data-content='Date the activity finished.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a>
                                </label>

                                <div class="input-append">
                                    <input data-bind='datepicker:endDate.date' name='endDate' id='endDate' type='text' size='16' class='input-xlarge' readonly='readonly' targetField='endDate.date' data-validation-engine='validate[future[startDate]]' />
<span class='add-on open-datepicker'>
  <i class='icon-th'>&nbsp;</i>
</span>
                                </div>

                            </div>
                        </div>
                        <div class="row-fluid space-after">
                            <div class="span6">
                                <label for="theme"><b>Major theme</b></label>
                                <select id="theme" data-bind="value:mainTheme, options:transients.themes, optionsCaption:'Choose..'" class="input-xlarge" style="width:90%">
                                </select>
                            </div>

                            <div class="span6">
                                <label><b>Progress</b></label>
                                <label for="activityComplete"><input type="checkbox" id="activityComplete" data-bind="checked:transients.markedAsFinished" style="margin-right:1em;"><span>This activity is complete</span></label>

                            </div>

                        </div>
                        <div class="row-fluid">
                            <div class="span6">
                                <label for="site"><b>Site</b></label>
                                <select id='site' style='width:90%' data-bind='options:transients.sites,optionsText:"name",optionsValue:"siteId",value:siteId,optionsCaption:"Choose a site..."'>&nbsp;</select>

                            </div>

                            <div class="span3">

                                <button class="btn btn-info" style="margin-top:25px;" data-bind="visible:transients.newSiteSupported,click:createNewSite">Create new Site</button>
                            </div>
                        </div>

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        
                        
                        

                        
                    </span>
                    <span class="span4">

                        <img id="siteLocationImage" width="100%" data-bind="event:{error:siteLoadError}, attr:{src:transients.siteImgUrl}, visible:transients.siteImgUrl()"/>


                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ko stopBinding: true -->

    
        
        
        
        <div class="output-block" id="koGeneral_information_&_Participants">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">General information & Participants</h3>
            <!-- add the dynamic components -->
            <div class="row-fluid space-after output-section" >
<div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Sampler name:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the person or group undertaking the sampling event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.samplerName'  type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Name of water body:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The name of the water body being sampled.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.waterbodyName'  data-validation-engine='validate[required]' type='text' class='input-small'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel required"><label>Type of water body:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Broad class of water body being sampled'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.waterType,options:transients.waterTypeConstraints,optionsCaption:"Please select"' data-validation-engine='validate[required]'></select></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Number in sampler group:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The total number of people participating in the sampling event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.totalParticipants' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>No. of volunteer participants:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The number of volunteers participating in the sampling event'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.numberOfVolunteerParticipants' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span4">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey time:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The time of the day that the survey was undertaken'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surveyTime' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Survey duration (hrs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The duration of the sampling event in hours'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surveyDuration' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div></div>

            
        </div>
    

    
        
        
        
        <div class="output-block" id="koEnvironmental_Information_at_the_Time_of_Sampling">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Environmental Information at the Time of Sampling</h3>
            <!-- add the dynamic components -->
            <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Rainfall in last 7 days:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General character of rainfall received at the sampling site over the 7 days prior to sampling.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.rainfall7Days,options:transients.rainfall7DaysConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Rainfall (mm):</label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTemperature' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Water level or flow:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General level of the water surface at the time of sampling, relative to it&apos;s normal level.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.waterLevel,options:transients.waterLevelConstraints,optionsCaption:"Please select"'></select></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Rate of Flow:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Description of the rate of flow of the water at the time of sampling.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input  class="span8 input-small" data-bind='value:data.waterFlowRate'  type='text' class='input-small'/></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Site observations:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about the site conditions at the time of the water quality monitoring event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

            
        </div>
    

    
        
        
        
        <div class="output-block" id="koWater_Quality_Measurements">
            <h3 data-bind="css:{modified:dirtyFlag.isDirty},attr:{title:'Has been modified'}">Water Quality Measurements</h3>
            <!-- add the dynamic components -->
            <div class="row-fluid space-after output-section" >
<div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Air Temperature (deg C):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The temperature of the air (in degrees Celsius) at 1.2 metres above the surface of the water at the time of sampling.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.airTemperature' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Water Temperature (deg C):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average temperature (in degrees Celsius) of the top few centimetres of water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTemperature' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>pH (pH units):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average pH of the top few centimetres of water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterPh' data-validation-engine='validate[min[0],max[14],custom[number]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Turbidity (NTUs):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average turbidity (in nephelometric turbidity units (NTUs)) of the water column at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.waterTurbidity' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Electrical Conductivity (ÂµS/cm):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='The average electrical conductivity (in microsiemens per centimetre) of the top few centimetres of water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterEc' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total Nitrogen (mg/L as N):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the total amount of nitrogen dissolved in a water sample in milligrams per litre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTotalNitrogen' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Nitrates (mg/L as N):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of nitrates dissolved in a water sample in milligrams per litre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterNitrates' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div></div><div class="span6">
<div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Available Phosphate (mg/L):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of available (soluble reactive component) phosphate in milligrams per litre of the water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterAvailableP' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Total Phosphate (mg/L):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the total amount of phosphate (reactive and unreactive components) in milligrams per litre of the water at the sampling site'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterTotalP' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Dissolved Oxygen (mg/L):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of oxygen dissolved in a water sample in milligrams per litre'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterDoMgl' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Dissolved Oxygen (% sat):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the amount of oxygen dissolved in a water sample expressed as a percentage of the oxygen holding capacity of the water at it&apos;s current temperature'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterDoPcSat' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Faecal Coliforms (CFU/100mL):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the density of faecal coliforms in a 100 millilitre sample of water'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterColiforms' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>E. coli (CFU/100mL):<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Measure of the density of the bacteria E. coli in a 100 millilitre sample of water'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><input class="input-small" style="text-align:center" data-bind='value:data.surfaceWaterEcoli' data-validation-engine='validate[custom[number],min[0]]' type='number' class='input-mini'/></span></div><div class="row-fluid"><span class="span12">    <span  class="span4 preLabel"><label>Did you calibrate your EC meter?:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='Indicator as to whether the electrical conductivity meter used had been calibrated prior to sampling'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><select class="span8" data-bind='value:data.instrumentCalibration,options:transients.instrumentCalibrationConstraints,optionsCaption:"Please select"'></select></span></div></div></div>
<div class="row-fluid space-after output-section" >
<span class="span12">    <span  class="preLabel"><label>Water Testing Notes/Issues:<a href='#' class='helphover' data-original-title='' data-placement='top' data-content='General comments and notes about this water quality monitoring event.'>
  <i class='icon-question-sign'>&nbsp;</i>
</a></label></span><textarea  class="span12" data-bind='value:data.notes'></textarea></span></div>

            
        </div>
    

<!-- /ko -->

</div>




</div>

<script src="static/Ttgu9fflIR2OzMMsmkluFvyNHUlZnRJc1rPIIvryZ5N.js" type="text/javascript" ></script>



<script src="static/N1Pu1Yy1dAP26vjRfEw0sZtbZhL03ir303dL4C7EaVF.js" type="text/javascript" ></script>

<script src="static/gfz9yoFSoT3bDIgFJCbjPP9WLeFgekRHSp7KxcpYrwj.js" type="text/javascript" ></script>
<script src="static/HpQC03jqzgdovdmQNni1bswagCkkBPaWGDIzgICGcvq.js" type="text/javascript" ></script>









<!--[if gte IE 8]><script src="static/knxjs4G9Cquc79O3iYW107XikPB1Z1ii8QWrtBpzlSP.js" type="text/javascript" ></script><![endif]-->
<script src="static/kSJb30BxnBzyoP0WndxrtZbaNWzT8x6LP2Cp7xI9PH4.js" type="text/javascript" ></script>
<script src="static/4NNgUS6xThBV2iHZmalcTOp8ioBIjnh2KnVAGLqz5SX.js" type="text/javascript" ></script>
<script src="static/MZjUSqmNLHqbPwhDcAMpejU18pr9ndMRCGKpPBHdSDL.js" type="text/javascript" ></script>
<script src="static/w51VyweI3KQvr6P2DTUzBcR9OpWeX0ktL7UktpeA1k.js" type="text/javascript" ></script>





<script src="static/7l2mDQFFpMnG14cXQPTKd94AN71T8yUF6dHUA2LCJIo.js" type="text/javascript" ></script>
<script src="static/ZbrF5cz3bJrkAqBXLrAlOmoaIYntVDIKpviQs5E8Rhy.js" type="text/javascript" ></script>
<script src="static/IZCc6ZgD3MepYbz4UqlDLzMDNNghSCivcfGebmF9V2d.js" type="text/javascript" ></script>
<script type="text/javascript">
            $(function(){

                var viewModelName = "General_information_&_ParticipantsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                        var speciesLists = [];
        var site = {};


                this[viewModelName] = function (output) {
                    var self = this;
                    self.name = "General information & Participants";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.surveyTime = ko.observable();

            self.data.surveyDuration = ko.observable();

            self.data.totalParticipants = ko.observable();

            self.data.samplerName = ko.observable();

            self.data.waterbodyName = ko.observable();

            self.data.numberOfVolunteerParticipants = ko.observable();

            self.data.waterType = ko.observable();
            self.transients.waterTypeConstraints = ["Estuary","Freshwater stream / channel","Freshwater lake / dam","Saline stream / channel","Saline lake / dam"];
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                
                delete jsData.activityType;
                delete jsData.transients;
                return jsData;
            };

            // this returns a JS object ready for saving
            self.modelForSaving = function () {
                // get model as a plain javascript object
                var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                // get rid of any transient observables
                return self.removeBeforeSave(jsData);
            };

            // this is a version of toJSON that just returns the model as it will be saved
            // it is used for detecting when the model is modified (in a way that should invoke a save)
            // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
            self.modelAsJSON = function () {
                return JSON.stringify(self.modelForSaving());
            };

            self.loadData = function (data) {
                // load dynamic data
                                self.data['surveyTime'](orZero(data['surveyTime']));
                self.data['surveyDuration'](orZero(data['surveyDuration']));
                self.data['totalParticipants'](orZero(data['totalParticipants']));
                self.data['samplerName'](data['samplerName']);
                self.data['waterbodyName'](data['waterbodyName']);
                self.data['numberOfVolunteerParticipants'](orZero(data['numberOfVolunteerParticipants']));
                self.data['waterType'](data['waterType']);


                // if there is no data in tables then add an empty row for the user to add data
                if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                    self.addRow();
                }
                self.transients.dummy.notifySubscribers();
            };
        };


        var savedData = activity;
        if (!savedData.outputs) {
            savedData.outputs = [];
        }
        var savedOutput = {};
        if (savedData) {

            $.each(savedData.outputs, function(i, tmpOutput) {
                if (tmpOutput.name === 'General information & Participants') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koGeneral_information_&_Participants"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

            
            $(function(){

                var viewModelName = "Environmental_Information_at_the_Time_of_SamplingViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                        var speciesLists = [];
        var site = {};


                this[viewModelName] = function (output) {
                    var self = this;
                    self.name = "Environmental Information at the Time of Sampling";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.rainfall7Days = ko.observable();
            self.transients.rainfall7DaysConstraints = ["Heavy","Moderate","Light","Nil"];

            self.data.rainfallMm = ko.observable();

            self.data.waterLevel = ko.observable();
            self.transients.waterLevelConstraints = ["Low","Medium","High","Flood","No flow","Dry / Isolated pool"];

            self.data.waterFlowRate = ko.observable();

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                
                delete jsData.activityType;
                delete jsData.transients;
                return jsData;
            };

            // this returns a JS object ready for saving
            self.modelForSaving = function () {
                // get model as a plain javascript object
                var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                // get rid of any transient observables
                return self.removeBeforeSave(jsData);
            };

            // this is a version of toJSON that just returns the model as it will be saved
            // it is used for detecting when the model is modified (in a way that should invoke a save)
            // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
            self.modelAsJSON = function () {
                return JSON.stringify(self.modelForSaving());
            };

            self.loadData = function (data) {
                // load dynamic data
                                self.data['rainfall7Days'](data['rainfall7Days']);
                self.data['rainfallMm'](orZero(data['rainfallMm']));
                self.data['waterLevel'](data['waterLevel']);
                self.data['waterFlowRate'](data['waterFlowRate']);
                self.data['notes'](data['notes']);


                // if there is no data in tables then add an empty row for the user to add data
                if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                    self.addRow();
                }
                self.transients.dummy.notifySubscribers();
            };
        };


        var savedData = activity;
        if (!savedData.outputs) {
            savedData.outputs = [];
        }
        var savedOutput = {};
        if (savedData) {

            $.each(savedData.outputs, function(i, tmpOutput) {
                if (tmpOutput.name === 'Environmental Information at the Time of Sampling') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koEnvironmental_Information_at_the_Time_of_Sampling"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

            
            $(function(){

                var viewModelName = "Water_Quality_MeasurementsViewModel",
                viewModelInstance = viewModelName + "Instance";

            // load dynamic models - usually objects in a list
                        var speciesLists = [];
        var site = {};


                this[viewModelName] = function (output) {
                    var self = this;
                    self.name = "Water Quality Measurements";
                self.outputId = orBlank(output.outputId);

                self.data = {};
                self.transients = {};
                self.transients.dummy = ko.observable();

                // add declarations for dynamic data
                
            self.data.airTemperature = ko.observable();

            self.data.surfaceWaterTemperature = ko.observable();

            self.data.surfaceWaterPh = ko.observable();

            self.data.surfaceWaterEc = ko.observable();

            self.data.waterTurbidity = ko.observable();

            self.data.surfaceWaterAvailableP = ko.observable();

            self.data.surfaceWaterTotalP = ko.observable();

            self.data.surfaceWaterDoMgl = ko.observable();

            self.data.surfaceWaterDoPcSat = ko.observable();

            self.data.surfaceWaterColiforms = ko.observable();

            self.data.surfaceWaterEcoli = ko.observable();

            self.data.surfaceWaterTotalNitrogen = ko.observable();

            self.data.surfaceWaterNitrates = ko.observable();

            self.data.instrumentCalibration = ko.observable();
            self.transients.instrumentCalibrationConstraints = ["Yes","No","Not applicable"];

            self.data.notes = ko.observable();
            self.transients.site = site;

                // this will be called when generating a savable model to remove transient properties
                self.removeBeforeSave = function (jsData) {
                    // add code to remove any transients added by the dynamic tags
                
                delete jsData.activityType;
                delete jsData.transients;
                return jsData;
            };

            // this returns a JS object ready for saving
            self.modelForSaving = function () {
                // get model as a plain javascript object
                var jsData = ko.mapping.toJS(self, {'ignore':['transients']});
                // get rid of any transient observables
                return self.removeBeforeSave(jsData);
            };

            // this is a version of toJSON that just returns the model as it will be saved
            // it is used for detecting when the model is modified (in a way that should invoke a save)
            // the ko.toJSON conversion is preserved so we can use it to view the active model for debugging
            self.modelAsJSON = function () {
                return JSON.stringify(self.modelForSaving());
            };

            self.loadData = function (data) {
                // load dynamic data
                                self.data['airTemperature'](orZero(data['airTemperature']));
                self.data['surfaceWaterTemperature'](orZero(data['surfaceWaterTemperature']));
                self.data['surfaceWaterPh'](orZero(data['surfaceWaterPh']));
                self.data['surfaceWaterEc'](orZero(data['surfaceWaterEc']));
                self.data['waterTurbidity'](orZero(data['waterTurbidity']));
                self.data['surfaceWaterAvailableP'](orZero(data['surfaceWaterAvailableP']));
                self.data['surfaceWaterTotalP'](orZero(data['surfaceWaterTotalP']));
                self.data['surfaceWaterDoMgl'](orZero(data['surfaceWaterDoMgl']));
                self.data['surfaceWaterDoPcSat'](orZero(data['surfaceWaterDoPcSat']));
                self.data['surfaceWaterColiforms'](orZero(data['surfaceWaterColiforms']));
                self.data['surfaceWaterEcoli'](orZero(data['surfaceWaterEcoli']));
                self.data['surfaceWaterTotalNitrogen'](orZero(data['surfaceWaterTotalNitrogen']));
                self.data['surfaceWaterNitrates'](orZero(data['surfaceWaterNitrates']));
                self.data['instrumentCalibration'](data['instrumentCalibration']);
                self.data['notes'](data['notes']);


                // if there is no data in tables then add an empty row for the user to add data
                if (typeof self.addRow === 'function' && self.rowCount() === 0) {
                    self.addRow();
                }
                self.transients.dummy.notifySubscribers();
            };
        };


        var savedData = activity;
        if (!savedData.outputs) {
            savedData.outputs = [];
        }
        var savedOutput = {};
        if (savedData) {

            $.each(savedData.outputs, function(i, tmpOutput) {
                if (tmpOutput.name === 'Water Quality Measurements') {
                        savedOutput = tmpOutput;
                    }
                });
            }

            window[viewModelInstance] = new this[viewModelName](savedOutput);
            var output = savedOutput.data ? savedOutput.data : {};

            window[viewModelInstance].loadData(output);
            window[viewModelInstance].dirtyFlag = ko.dirtyFlag(window[viewModelInstance], false);

            ko.applyBindings(window[viewModelInstance], document.getElementById("koWater_Quality_Measurements"));

            // this resets the baseline for detecting changes to the model
            // - shouldn't be required if everything behaves itself but acts as a backup for
            //   any binding side-effects
            // - note that it is not foolproof as applying the bindings happens asynchronously and there
            //   is no easy way to detect its completion
            window[viewModelInstance].dirtyFlag.reset();

            // register with the master controller so this model can participate in the save cycle
            master.register(viewModelInstance, window[viewModelInstance].modelForSaving,
            window[viewModelInstance].dirtyFlag.isDirty, window[viewModelInstance].dirtyFlag.reset);
        });

            


    /* Master controller for page. This handles saving each model as required. */
    var Master = function () {
        var self = this;
        this.subscribers = [];
        // client models register their name and methods to participate in saving
        self.register = function (modelInstanceName, getMethod, isDirtyMethod, resetMethod) {
            this.subscribers.push({
                model: modelInstanceName,
                get: getMethod,
                isDirty: isDirtyMethod,
                reset: resetMethod
            });
        };
        // master isDirty flag for the whole page - can control button enabling
        this.isDirty  = function () {
            var dirty = false;
            $.each(this.subscribers, function(i, obj) {
                dirty = dirty || obj.isDirty();
            });
            return dirty;
        };
        /**
         * Makes an ajax call to save any sections that have been modified. This includes the activity
         * itself and each output.
         *
         * Modified outputs are injected as a list into the activity object. If there is nothing to save
         * in the activity itself, then the root is an object that is empty except for the outputs list.
         *
         * NOTE that the model for each section must register itself to be included in this save.
         *
         * Validates the entire page before saving.
         * @return -1 if the page was not modified, 0 if validation failed, 1 if validation succeeded (or was not requested).
         */
        this.save = function (validate) {
            // Ensure any active change is committed - the knockout binding typically fires on blur.
            $( document.activeElement ).blur();

            if (validate === undefined) {
                validate = true;
            }
            var activityData, outputs = [];

            var success = true;
            if (validate) {
                success = $('#validation-container').validationEngine('validate');
            }
            if (!self.isDirty()) {
                mobileBindings.onSaveActivity(-1, null);
                return -1;
            }
            if (success) {
                $.each(this.subscribers, function(i, obj) {
                    if (obj.model === 'activityModel') {
                        activityData = obj.get();
                    } else {
                        outputs.push(obj.get());
                    }
                });

                if (activityData === undefined) { activityData = {}}
                activityData.outputs = outputs;

                var toSave = JSON.stringify(activityData);
                mobileBindings.onSaveActivity(1, toSave);

            }
            else {
                mobileBindings.onSaveActivity(0, null);
            }
            return success?1:0;
        };

        this.reset = function () {
            $.each(this.subscribers, function(i, obj) {
                if (obj.isDirty()) {
                    obj.reset();
                }
            });
        };

        this.addSite = function(site) {
            var viewModel = ko.dataFor(document.getElementById('site'));
            viewModel.transients.sites.push(site);
            viewModel.siteId(site.siteId);
        }
    };

    if (mobileBindings == undefined) {
        var mobileBindings = {
        
            loadActivity:function(){return "{}"},
        
        
            loadSites:function(){return "[]"},
        
        
            loadThemes:function(){return "[]"},
        

        supportsNewSite:function() { return true; },
        onSaveActivity:function(){},
        createNewSite:function(){}
    };
}
var master = new Master();
var activity = JSON.parse(mobileBindings.loadActivity());
var sites = JSON.parse(mobileBindings.loadSites());
var themes = JSON.parse(mobileBindings.loadThemes());

$(function(){

var scroll = false;

    scroll = true;

$('#validation-container').validationEngine('attach', {scroll: scroll});

$('.helphover').popover({animation: true, trigger:'hover'});

$('#reset').click(function () {
master.reset();
});


function ViewModel (act, sites, themes) {
var self = this;
var today = new Date().toISOStringNoMillis();

self.activityId = act.activityId;
self.description = ko.observable(act.description);
self.notes = ko.observable(act.notes);
self.startDate = ko.observable(act.startDate || today).extend({simpleDate: false});
self.endDate = ko.observable(act.endDate).extend({simpleDate: false});
self.plannedStartDate = ko.observable(act.plannedStartDate).extend({simpleDate: false});
self.plannedEndDate = ko.observable(act.plannedEndDate).extend({simpleDate: false});
self.eventPurpose = ko.observable(act.eventPurpose);
self.fieldNotes = ko.observable(act.fieldNotes);
self.associatedProgram = ko.observable(act.associatedProgram);
self.associatedSubProgram = ko.observable(act.associatedSubProgram);
self.progress = ko.observable(act.progress);
self.mainTheme = ko.observable(act.mainTheme);
self.type = ko.observable(act.type);
self.siteId = ko.observable(act.siteId);
self.projectId = act.projectId;
self.transients = {};
self.transients.sites = ko.observableArray(sites);
self.transients.photoPoints = ko.computed(function() {
    var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
     if (site) {
         return site.photoPoints ? site.photoPoints : site.poi;
     }
     return [];
});
self.transients.activityProgressValues = ['planned','started','finished'];
self.transients.themes = themes?themes:[];
self.transients.markedAsFinished = ko.observable(act.progress === 'finished');
self.transients.markedAsFinished.subscribe(function (finished) {
    self.progress(finished ? 'finished' : 'started');
    if (finished || !self.endDate()) {
        self.endDate(today);
    }
});
self.transients.siteImgUrl = ko.computed(function() {
    if (self.siteId()) {
         var site = $.grep(self.transients.sites(), function(site, index) { return site.siteId == self.siteId(); })[0];
         if (site) {
            var lat,lon;
            if (site.centroidLat !== undefined && site.centroidLon !== undefined) {
                lat = site.centroidLat;
                lon = site.centroidLon;
            }
            else if (site.extent && site.extent.geometry && site.extent.geometry.centre) {
                lat = site.extent.geometry.centre[1];
                lon = site.extent.geometry.centre[0];
            }
            if (lat !== undefined && lon !== undefined) {
                $('#siteLocationImage').show();
                return fcConfig.googleStaticUrl+lat+","+lon;
            }
         }
    }
    return "";
});
self.siteLoadError = function(data, event) {
    $('#siteLocationImage').hide();
};

self.transients.newSiteSupported = ko.observable( mobileBindings.supportsNewSite());

self.modelForSaving = function () {
    // get model as a plain javascript object
    var jsData = ko.toJS(self);
    delete jsData.transients;
    return jsData;
};
self.modelAsJSON = function () {
    return JSON.stringify(self.modelForSaving());
};

self.save = function (callback, key) {
};

self.createNewSite = function() {
    mobileBindings.createNewSite();
}

self.notImplemented = function () {
    alert("Not implemented yet.")
};

self.attachPhotoPoint = function(e) {
    console.log(e);
};
self.dirtyFlag = ko.dirtyFlag(self, false);

// make sure progress moves to started if we save any data (unless already finished)
// (do this here so the model becomes dirty)
self.progress(self.transients.markedAsFinished() ? 'finished' : 'started');
}


var viewModel = new ViewModel(activity, sites, themes);

ko.applyBindings(viewModel);

master.register('activityModel', viewModel.modelForSaving, viewModel.dirtyFlag.isDirty, viewModel.dirtyFlag.reset);


    // Workaround for Android bug 6721 - prevents components under the datepicker from receiving clicks on the datepicker.
    var disabled = null;
    $('[data-bind^=datepicker]').datepicker().on('show', function() {
        if (disabled == null) {
            disabled = $("input:enabled, select:enabled, button:enabled");
            disabled.prop('disabled', true);
        }
    });
    $('[data-bind^=datepicker]').datepicker().on('hide', function() {
        if (disabled !== null) {
            disabled.prop('disabled', false);
            disabled = null;
        }
    });

});


</script>
</body>
</html>